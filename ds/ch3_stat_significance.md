# 데이터 과학을 위한 통계 3장 : 통계적 실험과 유의성 검정

전통적인 실험설계에 대해 알아보고 데이터 과학에도 적용되는 몇몇 어려움에 대해 논의해보자. 

통계적 유의성, t 검정, p값 등은 **통계적 추론**이라는 파이프라인 속에 있다. 이 과정은 *가격 A가 기존 가격 B보다 수익성이 높다* 라는 식의 가설을 세우는 것에서 출발한다. 가설을 검정하고 원하는 결론을 도출할 수 있도록 실험을 설계한다. 그리고 데이터를 수집하고 분석하여 결론을 도출한다.

**추론 (inference)** 이라는 용어는 제한된 데이터로 이루어진 실험의 결과를 더 큰 대상 또는 모집단에 적용하고자 하는 의도를 나타낸다.

## (1) A/B 테스트

A/B 테스트는 두 처리 방법, 제품 , 혹은 절차 중 어느 쪽이 다른 쪽보다 더 우월하다는 것을 입증하기 위해 실험군을 두 그룹으로 나누어 진행하는 실험이다. 종종 두 가지 그룹 중 하나는 기존 방법이거나 아무런 처리를 하지 않는 **대조군** 으로 설정된다. 새로운 처리법을 적용하는 것이 대조군보다 낫다는 것이 일반적인 가설이 된다.

- 이상적인 경우 피험자는 **무작위** 로 A, B군 중 하나에 할당된다
- 그룹 간 비교에 사용하는 검정통계량 또는 측정 지표에 주의해야 한다 (이진 변수, 연속형, 횟수)
- 여러 가지 정보를 수집할 수 있지만, 사용하고자 하는 지표 또는 검정통계량을 사전에 미리 정해놓아야 한다. 
    - 실험 후에 지표를 선택한다면 연구자 편향에 빠질 수 있다.

### 대조군은 왜 필요할까?

대조군이 없다면 어떤 차이가 변경사항 때문인지 우연히 발생한 것인지 확신할 수 없다. 

## (2) 가설검정

가설검정 혹은 유의성 검정은 관찰된 효과가 우연에 의한 것인지 여부를 알아내기 위한 기법이다. 
사람들은 예외적인 사건을 예상하지 못하거나, 무작위로 발생한 사건을 의미있는 패턴으로 오해하는 경향이 있다. 
통계적 가설 검정은 연구자가 우연히 일어난 일에 속지 않도록 보호하기 위해 개발되었다.

### 귀무가설

가설검정에서는 실험을 통해 얻은 그룹 간의 차이가 랜덤으로 발생할 수 있는 합리적인 수준보다 더 극단적으로 다르다는 증거를 요구한다. 
이 과정에서 그룹 간의 차이는 우연에 의한 결과라는 것을 기본 가정으로 하는데, 이것을 **귀무가설** 이라고 한다.

### 대립가설

귀무가설과 대립하는 가설을 말한다. 몇 가지 예시를 살펴보자.

```
- 귀무가설 : A와 B 그룹의 평균에는 차이가 없다
- 대립가설 : A는 B와 다르다

- 귀무가설 : A는 B보다 작거나 같다
- 대립가설 : A는 B보다 크다

- 귀무가설 : B는 A보다 3% 크지 않다
- 대립가설 : B는 A보다 3% 크다
```

### 일원/이원 가설검정

방향성을 고려한 대립가설이 필요할 때도 있다 ( B가 A보다 크다 ). 이 경우에는 일원 가설검정 (한쪽 꼬리) 을 사용한다. 
어느 쪽으로도 속지 않도록 가설검정을 수행하려면 대립가설은 양방향이 된다 ( B는 A와 다르다 ). 이 경우에는 이원 가설검정 (양쪽 꼬리) 을 사용한다.

## (3) 재표본추출

**재표본추출**이란 랜덤한 변동성을 알아보자는 일반적인 목표를 가지고, 관찰된 데이터의 값에서 표본을 반복적으로 추출하는 것을 의미한다. 
또한 일부 머신러닝 모델의 정확성을 평가하고 향상시키는 데에도 적용할 수 있다. 

재표본추출에는 부트스트랩과 순열검정이라는 두 가지 주요 유형이 있다. 여기서는 순열검정에 대해 알아보려고 한다.

* 부트스트랩 : 추정의 신뢰성을 평가
* 순열검정 : 두 개 이상의 그룹과 관련된 가설을 검증

### 순열검정

순열검정에서는 여러 그룹들의 결과를 하나로 합친다. 
이것은 그룹들에 적용된 처리의 결과가 다르지 않다는 귀무가설을 구체화한 것이다. 
그 후 결합된 집합에서 무작위로 그룹을 뽑아 가설을 검정하고 서로 얼마나 다른지 확인한다. 
구체적인 절차는 다음과 같다.

1. 여러 그룹의 결과를 단일 데이터 집합으로 결합한다
2. 결합된 데이터를 잘 섞은 후, 그룹 A와 동일한 크기의 표본을 무작위로 비복원 추출한다
3. 나머지 데이터에서 그룹 B와 동일한 크기의 샘플을 무작위로 비복원 추출한다
4. 다른 그룹이 더 있다면 동일한 작업을 수행한다
5. 새로 추출한 재표본에서 통계량 또는 추정치를 다시 계산하고 기록한다
6. 앞선 단계를 R번 반복하고 검정통계량의 순열 분포를 얻는다

이제 실험을 통해 얻은 수치를 순열 과정에서 얻은 집합에서의 수치와 비교한다. 
관찰된 값이 재표본을 통해 얻은 값들의 분포와 비교했을 때 겹치는 구간에 있다면, 우연히 일어날 수 있는 범위 안에 있다는 말이다. 
하지만 그렇지 않을 경우 우연 때문이 아니라고 결론 내릴 수 있고, 이것을 **통계적으로 유의미하다** 고 표현한다.

### 전체 및 부트스트랩 순열검정

앞서 살펴본 랜덤 셔플링 절차를 임의순열검정 (Random Permutation Test) 또는 임의화검정 (Randomization Test) 이라고 부른다. 
이외에도 몇 가지 변종이 있다.

- **전체순열검정** (exhaustive permutation test)
    - 데이터를 무작위로 섞는 대신 실제로 발생할 수 있는 모든 가능한 조합을 찾는다
    - 샘플 크기가 비교적 작을 때만 실용적이다
    - 임의순열검정의 결과는 셔플링을 많이 반복할수록 전체순열검정의 결과와 비슷해진다
    - *유의미하다*같은 애매한 결론이 아닌 더 정확한 결론을 보장하기 때문에 정확검정 (exact test) 라고도 한다
- **부트스트랩 순열검정** (bootstrap permutation test)
    - 추출하는 과정을 **복원추출로 진행** 한다

### 순열검정의 장점

- 상대적으로 코딩하고, 해석하고, 설명하기 쉽다
- 데이터의 형태가 다양해도 된다
- 샘플 크기가 다양해도 된다
- 데이터가 정규분포를 따를 필요도 없다
